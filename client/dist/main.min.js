!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){var r;r=angular.module("florentindubois.kraken",["ngAria","ngAnimate","ngMaterial","ngMessages","ngRoute","ngSanitize","pascalprecht.translate","md.data.table"]),r.config(["$routeProvider",function(e){var t,n,r;r=[{path:"/fs",controller:"fs",templateUrl:"views/fs.jade"},{path:"/fs/:signet",controller:"fs",templateUrl:"views/fs.jade"},{path:"/manage-account",controller:"manageAccount",templateUrl:"views/manage-account.jade"}];for(t in r)n=r[t],e.when(n.path,{controller:"kraken."+n.controller,templateUrl:n.templateUrl});e.otherwise("/fs")}]),r.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo",{"default":"800"}).accentPalette("pink").warnPalette("red")}]),r.config(["$translateProvider",function(e){var t,r,o,u;for(o=["en"],t=0,u=o.length;t<u;t++)r=o[t],e.translations(r,n(2)("./"+r+".lang.json"));e.useSanitizeValueStrategy(null),e.preferredLanguage("en"),e.fallbackLanguage("en")}]),r.controller("kraken.fs",["$scope","$fs","$translate","$logger","$mdDialog","$routeParams","$signets","$compress","$mdSidenav","$share","$window",function(e,t,n,r,o,u,s,i,a,c,l){e.selecteds=[],e.files=[],e.load=!0,e.path="/",e.share={},e.realpath=t.realpath,e.list=function(n){return e.load=!0,e.path=t.realpath(n),t.list(n,function(t,n){if(e.load=!1,null==t)return e.files=n})},e.open=function(t){return e.list(e.path+"/"+t)},e.rename=function(u,s){return n("fs.renameDialog.title").then(function(i){return n("fs.renameDialog.text").then(function(a){return n("fs.renameDialog.placeholder").then(function(c){return n("fs.renameDialog.ok").then(function(l){return n("fs.renameDialog.cancel").then(function(f){var h;return h=o.prompt(),h.title(i).textContent(a).placeholder(c).ariaLabel(c).targetEvent(s).ok(l).cancel(f),o.show(h).then(function(o){return e.load=!0,t.rename(e.path+"/"+u,e.path+"/"+o,function(t,o){return null!=t?e.list(e.path):o.renamed===!0?n("fs.renameDialog.success").then(function(t){return e.list(e.path),r.info(t)}):void 0})},function(){})})})})})})},e.remove=function(o){return t.remove(e.path+"/"+o,function(t,u){if(null==t)return n("fs.remove").then(function(t){return e.list(e.path),r.info(t+" : "+o)})})},e.removeSelecteds=function(){var t,n,r,o,u;for(o=e.selecteds,u=[],n=0,r=o.length;n<r;n++)t=o[n],u.push(e.remove(t.name));return u},e.listFromSignet=function(t){return e.load=!0,s.getOne(t,function(t,n){return e.list(n.path)})},e.compress=function(t){return i.zip(e.path+"/"+t,function(t,o){if(null==t&&o.compressed===!0)return n("fs.compress.success").then(function(t){return r.info(t),e.list(e.path)})})},e.uncompress=function(t){return i.unzip(e.path+"/"+t,function(t,o){if(null==t&&o.uncompressed===!0)return n("fs.uncompress.success").then(function(t){return r.info(t),e.list(e.path)})})},e.bookmark=function(t){return s.create(e.path+"/"+t,function(e,t){if(!e&&t.created===!0)return n("fs.bookmark.success").then(function(e){return r.info(e)})})},e.isArchive=function(e){return/\.zip$/gi.test(e)},e.share=function(n){return e.share.path=t.realpath(e.path+"/"+n),a("right").toggle()},e.submitShare=function(t){return c.create(e.share.path,e.share.password,e.share.available,function(u,s){if(null==u&&s.created===!0)return a("right").toggle(),e.share={},n("fs.shareSuccessDialog.title").then(function(e){return n("fs.shareSuccessDialog.ok").then(function(n){var r;return r=o.alert().parent(angular.element(l.document.querySelector("body"))).title(e).ariaLabel(e).textContent(c.link(s._id)).ok(n).targetEvent(t),o.show(r)})}),n("fs.successShare").then(function(e){return r.info(e)})}),!1},null!=u.signet?e.listFromSignet(u.signet):e.list(e.path)}]),r.controller("kraken.login",["$scope","$user","$logger","$translate","$window","$timeout",function(e,t,n,r,o,u){e.login={},e.submit=function(){return t.login(e.login.username,e.login.password,function(e,t){if(null==e)return t.connected?r("login.success").then(function(e){return n.info(e),u(function(){return o.location.assign(t.redirect)},1e3)}):r("login.wrong").then(function(e){return n.error(e)})}),!1}}]),r.controller("kraken.manageAccount",["$scope","$user","$translate","$logger",function(e,t,n,r){e.users=[],e.user={},e.getUsers=function(){return t.getAll(function(t,n){if(null==t)return e.users=n,e.updateUser.$setPristine(),e.updateUser.$setUntouched(),e.user={}})},e.select=function(t){return e.user=e.users[t]},e.add=function(){return e.users.push({}),e.select(e.users.length-1)},e.remove=function(o){return t.remove(e.users[o]._id,function(t,o){if(null==t&&o.removed===!0)return n("manageAccount.removed").then(function(t){return r.info(t),e.getUsers()})})},e.save=function(){return null!=e.user._id?t.update(e.user,function(t,o){if(null==t&&o.updated===!0)return n("manageAccount.updated").then(function(t){return r.info(t),e.getUsers()})}):t.create(e.user,function(t,o){if(null==t&&o.created===!0)return n("manageAccount.created").then(function(t){return r.info(t),e.getUsers()})})},e.getUsers()}]),r.controller("kraken.navigation",["$scope","$user","$window","$mdSidenav","$menu","$bookmarks","$translate","$logger","$share",function(e,t,n,r,o,u,s,i,a){e.menu=[],e.bookmarks=[],e.shares=[],e.openSidenav=function(){return r("left").toggle()},e.exit=function(){return t.logout(function(e,t){if(null==e&&null!=t.redirect)return n.location.assign(t.redirect)})},e.removeBookmark=function(t){return u.remove(t,function(t,n){if(null==t&&n.removed)return s("navigation.removeBookmark").then(function(t){return i.info(t),e.getBookmarks()})})},e.removeShare=function(t){return a.remove(t,function(t,n){if(null==t&&n.removed)return s("navigation.removeShare").then(function(t){return i.info(t),e.getShares()})})},e.getBookmarks=function(){return u.getAll(function(t,n){if(null==t)return e.bookmarks=n})},e.getShares=function(){return a.getAll(function(t,n){if(null==t)return e.shares=n})},e.getShares(),e.getBookmarks(),o.getItems(function(t,n){if(null==t)return e.menu=n})}]),r.run(["$rootScope","$location","$user","$translate","$logger",function(e,t,n,r,o){var u;u=["/manage-account"],e.$on("$routeChangeStart",function(){if(-1!==u.indexOf(t.path()))return n.isAdministrator(function(e,n){if(null==e&&!n.administrator)return r("request.notAuthorized").then(function(e){return o.error(e),t.path("/fs")})})})}]),r.filter("bytes",[function(){return function(e,t){var n,r;return null==t&&(t=1),null!=e&&(0!==e?(r=["o","Ko","Mo","Go","To","Po"],n=Math.floor(Math.log(e)/Math.log(1024)),e=(e/Math.pow(1024,Math.floor(n))).toFixed(t)+" "+r[n]):e="0 o"),e}}]),r.filter("lower",[function(){return function(e){return null!=e&&(e=e.toLowerCase()),e}}]),r.filter("truncate",[function(){return function(e,t){return null==t&&(t=40),null!=e&&t<e.length&&(e=e.substring(0,t-3)+"..."),e}}]),r.filter("ucfirst",[function(){return function(e){return null!=e&&(e=""+e.charAt(0).toUpperCase()+e.substring(1)),e}}]),r.filter("upper",[function(){return function(e){return null!=e&&(e=e.toUpperCase()),e}}]),r.service("$bookmarks",["$request",function(e){this.get=function(t,n){return e.get("bookmarks/"+t,n)},this.getAll=function(t){return e.get("bookmarks",t)},this.create=function(t,n){return e.post("bookmarks",{path:t},n)},this.update=function(t,n,r){return e.put("bookmarks/"+t,{path:n},r)},this.remove=function(t,n){return e["delete"]("bookmarks/"+t,n)},this.removeAll=function(t){return e["delete"]("bookmarks",t)}}]),r.service("$compress",["$request","$fs",function(e,t){this.zip=function(n,r){return e.post(t.realpath("/compress/"+n),{},r)},this.unzip=function(n,r){return e["delete"](t.realpath("/compress/"+n),r)}}]),r.service("$fs",["$request",function(e){this.slach=function(e){for(;;){if(!/\/\//gi.test(e))return e;e=e.replace(/\/\//gi,"/")}},this.realpath=function(e){return function(t){var n,r,o,u;t=e.slach(t),r=t.split("/"),o=[];for(u in r)n=r[u],parseInt(u)+1<r.length&&".."===r[parseInt(u)+1]||".."!==n&&o.push(n);return 0===o.length?"/":1===o.length?o.join("/").substring(1):o.join("/")}}(this),this.list=function(t){return function(n,r){return e.get(t.slach("/fs/"+t.realpath(n)),r)}}(this),this.remove=function(t){return function(n,r){return e["delete"](t.slach("/fs/"+t.realpath(n)),r)}}(this),this.rename=function(t){return function(n,r,o){return e.patch(t.slach("/fs/"+t.realpath(n)),{path:t.slach(t.realpath(r))},o)}}(this)}]),r.service("$logger",["$mdToast",function(e){this.info=function(t){var n;return n=e.simple(),n.textContent(t).position("bottom right"),e.show(n)},this.warn=function(t){var n;return n=e.simple(),n.textContent(t).position("bottom right"),e.show(n)},this.error=function(t){var n;return n=e.simple(),n.textContent(t).position("bottom right"),e.show(n)}}]),r.service("$menu",["$request",function(e){this.getItems=function(t){return e.get("menu",t)}}]),r.service("$request",["$http","$logger","$translate",function(e,t,n){var r;r=function(e,r){return 403===e.status||401===e.status?n("request.notAuthorized").then(function(e){return t.error(e),r(new Error(e))}):404===e.status?n("request.notFound").then(function(e){return t.error(e),r(new Error(e))}):n("request.failure").then(function(e){return t.error(e),r(new Error(e))})},this.get=function(t,n){return e.get(t).then(function(e){return n(null,e.data)},function(e){return r(e,n)})},this.post=function(t,n,o){return e.post(t,n).then(function(e){return o(null,e.data)},function(e){return r(e,o)})},this.put=function(t,n,o){return e.put(t,n).then(function(e){return o(null,e.data)},function(e){return r(e,o)})},this.patch=function(t,n,o){return e.patch(t,n).then(function(e){return o(null,e.data)},function(e){return r(e,o)})},this["delete"]=function(t,n){return e["delete"](t).then(function(e){return n(null,e.data)},function(e){return r(e,n)})}}]),r.service("$share",["$request","$window",function(e,t){this.getAll=function(t){return e.get("/share",t)},this.get=function(t,n){return e.get("/share/"+t,n)},this.create=function(t,n,r,o){return e.post("/share",{path:t,password:n,available:r},o)},this.remove=function(t,n){return e["delete"]("/share/"+t,n)},this.link=function(e){return t.location.origin+"/mount/share/"+e}}]),r.service("$signets",["$request","$fs",function(e,t){this.get=function(t){return e.get("/signets",t)},this.getOne=function(t,n){return e.get("/signets/"+t,n)},this.create=function(n,r){return e.post("/signets",{path:t.realpath(n)},r)},this.update=function(n,r,o){return e.put("/signets/"+n,{path:t.realpath(r)},o)},this["delete"]=function(t,n){return e["delete"]("/signets/"+t,n)}}]),r.service("$user",["$request",function(e){this.get=function(t,n){return e.get("users/"+t,n)},this.update=function(t,n){return e.put("users/"+t._id,t,n)},this.remove=function(t,n){return e["delete"]("users/"+t,n)},this.create=function(t,n){return e.post("users",t,n)},this.getAll=function(t){return e.get("users",t)},this.isLog=function(t){return e.get("log",t)},this.login=function(t,n,r){return e.post("log",{username:t,password:n},r)},this.logout=function(t){return e["delete"]("log",t)},this.isAdministrator=function(t){return e.get("administrator",t)}}])},function(e,t,n){function r(e){return n(o(e))}function o(e){return u[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var u={"./en.lang.json":3};r.keys=function(){return Object.keys(u)},r.resolve=o,e.exports=r,r.id=2},function(e,t){e.exports={app:{name:"Kraken"},toolbar:{exit:"Exit"},navigation:{fs:"File system",manageAccount:"Manage account",menu:"Menu",removeBookmark:"Successfuly removed bookmark",removeShare:"Successfuly removed sharing",bookmark:{singular:"Bookmark",plural:"Bookmarks"},share:{singular:"Share",plural:"Shares"}},request:{failure:"Request failure",notAuthorized:"Your are not authorized to perform this action",notFound:"Request document is not found"},login:{send:"Sign in",username:"Username",password:"Password",success:"Successfuly connected",wrong:"Wrong password or username",error:{required:"This field is required"}},manageAccount:{username:"User name",password:"Password",firstname:"First name",lastname:"Last name",email:"Mail",administrator:"His an administrator ?",submit:"Save",remove:"Remove",userInformation:"User information",userInformationComplete:"Complete information about user",selectUser:"Select user to modify",addAdministrator:"Create a new user",removed:"Successfuly removed an user",updated:"Successfuly updated an user",created:"Successfuly created an user",error:{required:"This is required.",email:"This is not a correct email."}},fs:{remove:"Successfuly removed",successShare:"Successfuly share",renameDialog:{title:"Rename",text:"Rename a file or folder",placeholder:"New name",ok:"Ok",cancel:"Cancel",success:"Successfuly renamed"},shareForm:{path:{label:"Path",description:"Path that will be share"},password:{label:"Password",required:"This is required",description:"Choose password to protect the link"},available:{label:"Date",required:"This is required",description:"Date for the validity of the link"},share:"Share"},shareSuccessDialog:{title:"Link to access",ok:"Ok"},table:{name:"Name",size:"Size",mtime:"Last modified"},options:{bookmarks:"Bookmarks",open:"Open",share:"Share",rename:"Rename",download:"Download",archive:"Compress",unarchive:"Uncompress","delete":"Delete"},fab:{menu:"Menu",refresh:"Refresh",root:"Go to root",share:"Shared file or folder"},toolbar:{filter:"",list:"List",item:{singular:"item selected",plural:"items selecteds"}},bookmark:{success:"Successfuly bookmarks"},compress:{success:"Successfuly compressed"},uncompress:{success:"Successfuly uncompressed"}}}}]);